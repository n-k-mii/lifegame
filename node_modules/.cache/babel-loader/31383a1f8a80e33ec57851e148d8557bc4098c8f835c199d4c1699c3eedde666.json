{"ast":null,"code":"import { Base } from './index';\nimport { compatibleMemberDecorator } from './deco3/utils';\nconst SlotSymbol = Symbol('vue-facing-decorator-slot');\nclass Slot {\n  constructor(master) {\n    this.names = new Map();\n    this.inComponent = false;\n    this.cachedVueComponent = null;\n    this.master = master;\n  }\n  obtainMap(name) {\n    let map = this.getMap(name);\n    if (!map) {\n      map = new Map();\n      this.names.set(name, map);\n    }\n    return map;\n  }\n  getMap(name) {\n    const map = this.names.get(name);\n    return map;\n  }\n}\nexport function makeSlot(obj, defaultSlot) {\n  if (getSlot(obj)) {\n    throw '';\n  }\n  if (defaultSlot) {\n    defaultSlot.master = obj;\n  }\n  const slot = defaultSlot !== null && defaultSlot !== void 0 ? defaultSlot : new Slot(obj);\n  Object.defineProperty(obj, SlotSymbol, {\n    enumerable: false,\n    value: slot\n  });\n  return slot;\n}\nexport function getSlot(obj) {\n  var _a;\n  return (_a = Object.getOwnPropertyDescriptor(obj, SlotSymbol)) === null || _a === void 0 ? void 0 : _a.value;\n}\nexport function obtainSlot(obj, defaultSlot) {\n  const slot = getSlot(obj);\n  if (slot) {\n    return slot;\n  }\n  return makeSlot(obj, defaultSlot);\n}\nexport function makeObject(names, obj) {\n  return names.reduce((pv, cv) => {\n    pv[cv] = obj[cv];\n    return pv;\n  }, {});\n}\nexport function toComponentReverse(obj) {\n  const arr = [];\n  let curr = obj;\n  do {\n    arr.unshift(curr);\n    curr = Object.getPrototypeOf(curr);\n  } while (curr.constructor !== Base && !getSlot(curr));\n  return arr;\n}\nexport function getSuperSlot(obj) {\n  let curr = Object.getPrototypeOf(obj);\n  while (curr.constructor !== Base) {\n    const slot = getSlot(curr);\n    if (slot) {\n      return slot;\n    }\n    curr = Object.getPrototypeOf(curr);\n  }\n  return null;\n}\n/**\n * Exclude decorated names by a filter\n */\nexport function excludeNames(names, slot, filter) {\n  return names.filter(name => {\n    let currSlot = slot;\n    while (currSlot != null) {\n      for (const mapName of currSlot.names.keys()) {\n        if (filter && !filter(mapName)) {\n          continue;\n        }\n        if (mapName === 'customDecorator') {\n          const map = currSlot.obtainMap('customDecorator');\n          if (map.has(name)) {\n            if (map.get(name).every(ite => !ite.preserve)) {\n              return false;\n            } else {\n              continue;\n            }\n          }\n        }\n        const map = currSlot.names.get(mapName);\n        if (map.has(name)) {\n          return false;\n        }\n      }\n      currSlot = getSuperSlot(currSlot.master);\n    }\n    return true;\n  });\n}\n/**\n * Get own properties by a filter\n */\nexport function getValidNames(obj, filter) {\n  const descriptors = Object.getOwnPropertyDescriptors(obj);\n  return Object.keys(descriptors).filter(name => filter(descriptors[name], name));\n}\nexport function optionNullableMemberDecorator(handler) {\n  function decorator(optionOrProto, name) {\n    if (name) {\n      compatibleMemberDecorator(function (proto, name) {\n        handler(proto, name);\n      })(optionOrProto, name);\n    } else {\n      return compatibleMemberDecorator(function (proto, name) {\n        handler(proto, name, optionOrProto);\n      });\n    }\n  }\n  return decorator;\n}\nexport function getProviderFunction(provide) {\n  if (typeof provide === 'function') return provide;\n  return function () {\n    return provide || {};\n  };\n}","map":{"version":3,"names":["Base","compatibleMemberDecorator","SlotSymbol","Symbol","Slot","constructor","master","names","Map","inComponent","cachedVueComponent","obtainMap","name","map","getMap","set","get","makeSlot","obj","defaultSlot","getSlot","slot","Object","defineProperty","enumerable","value","_a","getOwnPropertyDescriptor","obtainSlot","makeObject","reduce","pv","cv","toComponentReverse","arr","curr","unshift","getPrototypeOf","getSuperSlot","excludeNames","filter","currSlot","mapName","keys","has","every","ite","preserve","getValidNames","descriptors","getOwnPropertyDescriptors","optionNullableMemberDecorator","handler","decorator","optionOrProto","proto","getProviderFunction","provide"],"sources":["../../src/utils.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}