{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { compatibleMemberDecorator } from '../deco3/utils';\nimport { obtainSlot } from '../utils';\nexport function decorator(setupFunction) {\n  return compatibleMemberDecorator(function (proto, name) {\n    const slot = obtainSlot(proto);\n    const map = slot.obtainMap('setup');\n    map.set(name, {\n      setupFunction\n    });\n  });\n}\nconst isPromise = v => v instanceof Promise;\nexport function build(cons, optionBuilder) {\n  const slot = obtainSlot(cons.prototype);\n  const map = slot.getMap('setup');\n  if (!map || map.size === 0) {\n    return;\n  }\n  const setup = function (props, ctx) {\n    const setupData = {};\n    let promises = null;\n    for (const name of map.keys()) {\n      const setupState = map.get(name).setupFunction(props, ctx);\n      if (isPromise(setupState)) {\n        promises !== null && promises !== void 0 ? promises : promises = [];\n        promises.push(setupState.then(v => {\n          setupData[name] = v;\n        }));\n      } else {\n        setupData[name] = setupState;\n      }\n    }\n    if (Array.isArray(promises)) {\n      return Promise.all(promises).then(() => {\n        return setupData;\n      });\n    } else {\n      return setupData;\n    }\n  };\n  optionBuilder.setup = setup;\n}","map":{"version":3,"names":["compatibleMemberDecorator","obtainSlot","decorator","setupFunction","proto","name","slot","map","obtainMap","set","isPromise","v","Promise","build","cons","optionBuilder","prototype","getMap","size","setup","props","ctx","setupData","promises","keys","setupState","get","push","then","Array","isArray","all"],"sources":["../../../src/option/setup.ts"],"sourcesContent":[null],"mappings":";AAAA,SAASA,yBAAyB,QAAQ,gBAAgB;AAI1D,SAASC,UAAU,QAAQ,UAAU;AAMrC,OAAM,SAAUC,SAASA,CAACC,aAAkC;EACxD,OAAOH,yBAAyB,CAAC,UAAUI,KAAU,EAAEC,IAAY;IAC/D,MAAMC,IAAI,GAAGL,UAAU,CAACG,KAAK,CAAC;IAC9B,MAAMG,GAAG,GAAGD,IAAI,CAACE,SAAS,CAAC,OAAO,CAAC;IACnCD,GAAG,CAACE,GAAG,CAACJ,IAAI,EAAE;MACVF;KACH,CAAC;EACN,CAAC,CAAC;AACN;AAEA,MAAMO,SAAS,GAAIC,CAAM,IAAwBA,CAAC,YAAYC,OAAO;AAErE,OAAM,SAAUC,KAAKA,CAACC,IAAU,EAAEC,aAA4B;EAC1D,MAAMT,IAAI,GAAGL,UAAU,CAACa,IAAI,CAACE,SAAS,CAAC;EACvC,MAAMT,GAAG,GAAGD,IAAI,CAACW,MAAM,CAAC,OAAO,CAAC;EAChC,IAAI,CAACV,GAAG,IAAIA,GAAG,CAACW,IAAI,KAAK,CAAC,EAAE;IACxB;;EAEJ,MAAMC,KAAK,GAAwB,SAAAA,CAAUC,KAAK,EAAEC,GAAG;IAEnD,MAAMC,SAAS,GAAwB,EAAE;IACzC,IAAIC,QAAQ,GAA0B,IAAI;IAC1C,KAAK,MAAMlB,IAAI,IAAIE,GAAG,CAACiB,IAAI,EAAE,EAAE;MAE3B,MAAMC,UAAU,GAAGlB,GAAG,CAACmB,GAAG,CAACrB,IAAI,CAAE,CAACF,aAAa,CAACiB,KAAK,EAAEC,GAAG,CAAC;MAE3D,IAAIX,SAAS,CAACe,UAAU,CAAC,EAAE;QACvBF,QAAQ,aAARA,QAAQ,cAARA,QAAQ,GAARA,QAAQ,GAAK,EAAE;QACfA,QAAQ,CAACI,IAAI,CAACF,UAAU,CAACG,IAAI,CAAEjB,CAAC,IAAI;UAChCW,SAAS,CAACjB,IAAI,CAAC,GAAGM,CAAC;QACvB,CAAC,CAAC,CAAC;OACN,MAAM;QACHW,SAAS,CAACjB,IAAI,CAAC,GAAGoB,UAAU;;;IAGpC,IAAII,KAAK,CAACC,OAAO,CAACP,QAAQ,CAAC,EAAE;MACzB,OAAOX,OAAO,CAACmB,GAAG,CAACR,QAAQ,CAAC,CAACK,IAAI,CAAC,MAAK;QACnC,OAAON,SAAS;MACpB,CAAC,CAAC;KACL,MAAM;MACH,OAAOA,SAAS;;EAExB,CAAC;EAEDP,aAAa,CAACI,KAAK,GAAGA,KAAK;AAC/B","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}