{"ast":null,"code":"import { defineComponent } from 'vue';\nimport { obtainSlot, getSuperSlot, getProviderFunction } from './utils';\nimport { build as optionSetup } from './option/setup';\nimport { build as optionComputed } from './option/computed';\nimport { build as optionData } from './option/data';\nimport { build as optionMethodsAndHooks } from './option/methodsAndHooks';\nimport { build as optionRef } from './option/ref';\nimport { build as optionWatch } from './option/watch';\nimport { build as optionProps } from './option/props';\nimport { build as optionInject } from './option/inject';\nimport { build as optionProvide } from './option/provide';\nimport { build as optionEmit } from './option/emit';\nimport { build as optionVModel } from './option/vmodel';\nimport { build as optionAccessor } from './option/accessor';\nimport * as DecoratorCompatible from './deco3/utils';\nfunction ComponentOption(cons, extend) {\n  const optionBuilder = {};\n  optionSetup(cons, optionBuilder);\n  optionVModel(cons, optionBuilder);\n  optionComputed(cons, optionBuilder); //after VModel\n  optionWatch(cons, optionBuilder);\n  optionProps(cons, optionBuilder);\n  optionInject(cons, optionBuilder);\n  optionEmit(cons, optionBuilder);\n  optionRef(cons, optionBuilder); //after Computed\n  optionAccessor(cons, optionBuilder);\n  optionMethodsAndHooks(cons, optionBuilder); //the last one\n  const raw = Object.assign(Object.assign({\n    name: cons.name,\n    setup: optionBuilder.setup,\n    data() {\n      var _a;\n      delete optionBuilder.data;\n      optionData(cons, optionBuilder, this);\n      return (_a = optionBuilder.data) !== null && _a !== void 0 ? _a : {};\n    },\n    methods: optionBuilder.methods,\n    computed: optionBuilder.computed,\n    watch: optionBuilder.watch,\n    props: optionBuilder.props,\n    inject: optionBuilder.inject,\n    provide() {\n      var _a;\n      optionProvide(cons, optionBuilder, this);\n      return (_a = optionBuilder.provide) !== null && _a !== void 0 ? _a : {};\n    }\n  }, optionBuilder.hooks), {\n    extends: extend\n  });\n  return raw;\n}\nfunction buildComponent(cons, arg, extend) {\n  var _a, _b;\n  const option = ComponentOption(cons, extend);\n  const slot = obtainSlot(cons.prototype);\n  Object.keys(arg).reduce((option, name) => {\n    if (['options', 'modifier', 'methods', 'emits', 'setup', 'provide'].includes(name)) {\n      return option;\n    }\n    option[name] = arg[name];\n    return option;\n  }, option);\n  //apply event emits\n  let emits = Array.from(slot.obtainMap('emits').keys());\n  if (Array.isArray(arg.emits)) {\n    emits = Array.from(new Set([...emits, ...arg.emits]));\n  }\n  option.emits = emits;\n  //merge methods\n  if ('object' === typeof arg.methods && !Array.isArray(arg.methods) && arg.methods !== null) {\n    (_a = option.methods) !== null && _a !== void 0 ? _a : option.methods = {};\n    Object.assign(option.methods, arg.methods);\n  }\n  //merge setup function\n  if (!option.setup) {\n    option.setup = arg.setup;\n  } else {\n    const oldSetup = option.setup;\n    const newSetup = (_b = arg.setup) !== null && _b !== void 0 ? _b : function () {\n      return {};\n    };\n    const setup = function (props, ctx) {\n      const newRet = newSetup(props, ctx);\n      const oldRet = oldSetup(props, ctx);\n      if (oldRet instanceof Promise || newRet instanceof Promise) {\n        return Promise.all([newRet, oldRet]).then(arr => {\n          return Object.assign({}, arr[0], arr[1]);\n        });\n      } else {\n        return Object.assign({}, newRet, oldRet);\n      }\n    };\n    option.setup = setup;\n  }\n  //merge provide function\n  const oldProvider = getProviderFunction(option.provide);\n  const newProvider = getProviderFunction(arg.provide);\n  option.provide = function () {\n    return Object.assign({}, oldProvider.call(this), newProvider.call(this));\n  };\n  //custom decorator\n  const map = slot.getMap('customDecorator');\n  if (map && map.size > 0) {\n    map.forEach(v => {\n      v.forEach(ite => ite.creator.apply({}, [option, ite.key]));\n    });\n  }\n  //shallow merge options\n  if (arg.options) {\n    Object.assign(option, arg.options);\n  }\n  //apply modifier\n  if (arg.modifier) {\n    arg.modifier(option);\n  }\n  return defineComponent(option);\n}\nfunction build(cons, option) {\n  const slot = obtainSlot(cons.prototype);\n  slot.inComponent = true;\n  const superSlot = getSuperSlot(cons.prototype);\n  if (superSlot) {\n    if (!superSlot.inComponent) {\n      throw 'Class should be decorated by Component or ComponentBase: ' + slot.master;\n    }\n    if (superSlot.cachedVueComponent === null) {\n      throw 'Component decorator 1';\n    }\n  }\n  const component = buildComponent(cons, option, superSlot === null ? undefined : superSlot.cachedVueComponent);\n  component.__vfdConstructor = cons;\n  slot.cachedVueComponent = component;\n  cons.__vccOpts = component;\n}\nfunction _Component(cb, arg, ctx) {\n  if (typeof arg === 'function') {\n    return DecoratorCompatible.compatibleClassDecorator(function (cons) {\n      return cb(cons, {});\n    })(arg, ctx);\n  }\n  return DecoratorCompatible.compatibleClassDecorator(function (cons) {\n    return cb(cons, arg);\n  });\n}\nexport function ComponentBase(arg, ctx) {\n  return _Component(function (cons, option) {\n    build(cons, option);\n    return cons;\n  }, arg, ctx);\n}\nexport const Component = ComponentBase;\nexport function toNative(cons) {\n  const slot = obtainSlot(cons.prototype);\n  if (!slot.inComponent) {\n    throw 'to native 1';\n  }\n  const cached = slot.cachedVueComponent;\n  if (!cached) {\n    throw 'to native 2';\n  }\n  return cached;\n}","map":{"version":3,"names":["defineComponent","obtainSlot","getSuperSlot","getProviderFunction","build","optionSetup","optionComputed","optionData","optionMethodsAndHooks","optionRef","optionWatch","optionProps","optionInject","optionProvide","optionEmit","optionVModel","optionAccessor","DecoratorCompatible","ComponentOption","cons","extend","optionBuilder","raw","Object","assign","name","setup","data","_a","methods","computed","watch","props","inject","provide","hooks","extends","buildComponent","arg","option","slot","prototype","keys","reduce","includes","emits","Array","from","obtainMap","isArray","Set","oldSetup","newSetup","_b","ctx","newRet","oldRet","Promise","all","then","arr","oldProvider","newProvider","call","map","getMap","size","forEach","v","ite","creator","apply","key","options","modifier","inComponent","superSlot","master","cachedVueComponent","component","undefined","__vfdConstructor","__vccOpts","_Component","cb","compatibleClassDecorator","ComponentBase","Component","toNative","cached"],"sources":["../../src/component.ts"],"sourcesContent":[null],"mappings":"AAAA,SAASA,eAAe,QAAyD,KAAK;AACtF,SAASC,UAAU,EAAEC,YAAY,EAAEC,mBAAmB,QAAQ,SAAS;AACvE,SAASC,KAAK,IAAIC,WAAW,QAAQ,gBAAgB;AACrD,SAASD,KAAK,IAAIE,cAAc,QAAQ,mBAAmB;AAC3D,SAASF,KAAK,IAAIG,UAAU,QAAQ,eAAe;AACnD,SAASH,KAAK,IAAII,qBAAqB,QAAQ,0BAA0B;AACzE,SAASJ,KAAK,IAAIK,SAAS,QAAQ,cAAc;AACjD,SAASL,KAAK,IAAIM,WAAW,QAAQ,gBAAgB;AACrD,SAASN,KAAK,IAAIO,WAAW,QAAQ,gBAAgB;AACrD,SAASP,KAAK,IAAIQ,YAAY,QAAQ,iBAAiB;AACvD,SAASR,KAAK,IAAIS,aAAa,QAAQ,kBAAkB;AACzD,SAAST,KAAK,IAAIU,UAAU,QAAQ,eAAe;AACnD,SAASV,KAAK,IAAIW,YAAY,QAAQ,iBAAiB;AACvD,SAASX,KAAK,IAAIY,cAAc,QAAQ,mBAAmB;AAI3D,OAAO,KAAKC,mBAAmB,MAAM,eAAe;AAMpD,SAASC,eAAeA,CAACC,IAAU,EAAEC,MAAY;EAC7C,MAAMC,aAAa,GAAkB,EAAE;EACvChB,WAAW,CAACc,IAAI,EAAEE,aAAa,CAAC;EAChCN,YAAY,CAACI,IAAI,EAAEE,aAAa,CAAC;EACjCf,cAAc,CAACa,IAAI,EAAEE,aAAa,CAAC;EACnCX,WAAW,CAACS,IAAI,EAAEE,aAAa,CAAC;EAChCV,WAAW,CAACQ,IAAI,EAAEE,aAAa,CAAC;EAChCT,YAAY,CAACO,IAAI,EAAEE,aAAa,CAAC;EACjCP,UAAU,CAACK,IAAI,EAAEE,aAAa,CAAC;EAC/BZ,SAAS,CAACU,IAAI,EAAEE,aAAa,CAAC;EAC9BL,cAAc,CAACG,IAAI,EAAEE,aAAa,CAAC;EACnCb,qBAAqB,CAACW,IAAI,EAAEE,aAAa,CAAC;EAC1C,MAAMC,GAAG,GAAAC,MAAA,CAAAC,MAAA,CAAAD,MAAA,CAAAC,MAAA;IACLC,IAAI,EAAEN,IAAI,CAACM,IAAI;IACfC,KAAK,EAAEL,aAAa,CAACK,KAAK;IAC1BC,IAAIA,CAAA;;MACA,OAAON,aAAa,CAACM,IAAI;MACzBpB,UAAU,CAACY,IAAI,EAAEE,aAAa,EAAE,IAAI,CAAC;MACrC,OAAO,CAAAO,EAAA,GAAAP,aAAa,CAACM,IAAI,cAAAC,EAAA,cAAAA,EAAA,GAAI,EAAE;IACnC,CAAC;IACDC,OAAO,EAAER,aAAa,CAACQ,OAAO;IAC9BC,QAAQ,EAAET,aAAa,CAACS,QAAQ;IAChCC,KAAK,EAAEV,aAAa,CAACU,KAAK;IAC1BC,KAAK,EAAEX,aAAa,CAACW,KAAK;IAC1BC,MAAM,EAAEZ,aAAa,CAACY,MAAM;IAC5BC,OAAOA,CAAA;;MACHrB,aAAa,CAACM,IAAI,EAAEE,aAAa,EAAE,IAAI,CAAC;MACxC,OAAO,CAAAO,EAAA,GAAAP,aAAa,CAACa,OAAO,cAAAN,EAAA,cAAAA,EAAA,GAAI,EAAE;IACtC;EAAC,GACEP,aAAa,CAACc,KAAK;IACtBC,OAAO,EAAEhB;EAAM,EAClB;EACD,OAAOE,GAAU;AACrB;AAqBA,SAASe,cAAcA,CAAClB,IAAU,EAAEmB,GAAoB,EAAElB,MAAY;;EAClE,MAAMmB,MAAM,GAAGrB,eAAe,CAACC,IAAI,EAAEC,MAAM,CAAC;EAC5C,MAAMoB,IAAI,GAAGvC,UAAU,CAACkB,IAAI,CAACsB,SAAS,CAAC;EACvClB,MAAM,CAACmB,IAAI,CAACJ,GAAG,CAAC,CAACK,MAAM,CAAsB,CAACJ,MAAM,EAAEd,IAAY,KAAI;IAClE,IAAI,CAAC,SAAS,EAAE,UAAU,EAAE,SAAS,EAAE,OAAO,EAAE,OAAO,EAAE,SAAS,CAAC,CAACmB,QAAQ,CAACnB,IAAI,CAAC,EAAE;MAChF,OAAOc,MAAM;;IAEjBA,MAAM,CAACd,IAAI,CAAC,GAAGa,GAAG,CAACb,IAA6B,CAAC;IACjD,OAAOc,MAAM;EACjB,CAAC,EAAEA,MAAM,CAAC;EAEV;EACA,IAAIM,KAAK,GAAGC,KAAK,CAACC,IAAI,CAACP,IAAI,CAACQ,SAAS,CAAC,OAAO,CAAC,CAACN,IAAI,EAAE,CAAC;EACtD,IAAII,KAAK,CAACG,OAAO,CAACX,GAAG,CAACO,KAAK,CAAC,EAAE;IAC1BA,KAAK,GAAGC,KAAK,CAACC,IAAI,CAAC,IAAIG,GAAG,CAAC,CAAC,GAAGL,KAAK,EAAE,GAAGP,GAAG,CAACO,KAAK,CAAC,CAAC,CAAC;;EAEzDN,MAAM,CAACM,KAAK,GAAGA,KAAK;EAEpB;EACA,IAAI,QAAQ,KAAK,OAAOP,GAAG,CAACT,OAAO,IAAI,CAACiB,KAAK,CAACG,OAAO,CAACX,GAAG,CAACT,OAAO,CAAC,IAAIS,GAAG,CAACT,OAAO,KAAK,IAAI,EAAE;IACxF,CAAAD,EAAA,GAAAW,MAAM,CAACV,OAAO,cAAAD,EAAA,cAAAA,EAAA,GAAdW,MAAM,CAACV,OAAO,GAAG,EAAE;IACnBN,MAAM,CAACC,MAAM,CAACe,MAAM,CAACV,OAAO,EAAES,GAAG,CAACT,OAAO,CAAC;;EAG9C;EACA,IAAI,CAACU,MAAM,CAACb,KAAK,EAAE;IACfa,MAAM,CAACb,KAAK,GAAGY,GAAG,CAACZ,KAAK;GAC3B,MAAM;IACH,MAAMyB,QAAQ,GAAwBZ,MAAM,CAACb,KAAK;IAClD,MAAM0B,QAAQ,GAA2B,CAAAC,EAAA,GAAAf,GAAG,CAACZ,KAAK,cAAA2B,EAAA,cAAAA,EAAA,GAAI;MAAc,OAAO,EAAE;IAAC,CAAC;IAE/E,MAAM3B,KAAK,GAA2B,SAAAA,CAAUM,KAAK,EAAEsB,GAAG;MACtD,MAAMC,MAAM,GAAGH,QAAQ,CAACpB,KAAK,EAAEsB,GAAG,CAAC;MACnC,MAAME,MAAM,GAAGL,QAAQ,CAACnB,KAAK,EAAEsB,GAAG,CAAC;MACnC,IAAIE,MAAM,YAAYC,OAAO,IAAIF,MAAM,YAAYE,OAAO,EAAE;QACxD,OAAOA,OAAO,CAACC,GAAG,CAAC,CAACH,MAAM,EAAEC,MAAM,CAAC,CAAC,CAACG,IAAI,CAAEC,GAAG,IAAI;UAC9C,OAAOrC,MAAM,CAACC,MAAM,CAAC,EAAE,EAAEoC,GAAG,CAAC,CAAC,CAAC,EAAEA,GAAG,CAAC,CAAC,CAAC,CAAC;QAC5C,CAAC,CAAC;OACL,MAAM;QACH,OAAOrC,MAAM,CAACC,MAAM,CAAC,EAAE,EAAE+B,MAAM,EAAEC,MAAM,CAAC;;IAEhD,CAAC;IAEDjB,MAAM,CAACb,KAAK,GAAGA,KAAK;;EAGxB;EACA,MAAMmC,WAAW,GAAG1D,mBAAmB,CAACoC,MAAM,CAACL,OAAO,CAAC;EACvD,MAAM4B,WAAW,GAAG3D,mBAAmB,CAACmC,GAAG,CAACJ,OAAO,CAAC;EACpDK,MAAM,CAACL,OAAO,GAAG;IACb,OAAOX,MAAM,CAACC,MAAM,CAAC,EAAE,EAAEqC,WAAW,CAACE,IAAI,CAAC,IAAI,CAAC,EAAED,WAAW,CAACC,IAAI,CAAC,IAAI,CAAC,CAAC;EAC5E,CAAC;EAED;EACA,MAAMC,GAAG,GAAGxB,IAAI,CAACyB,MAAM,CAAC,iBAAiB,CAAC;EAC1C,IAAID,GAAG,IAAIA,GAAG,CAACE,IAAI,GAAG,CAAC,EAAE;IACrBF,GAAG,CAACG,OAAO,CAAEC,CAAC,IAAI;MACdA,CAAC,CAACD,OAAO,CAACE,GAAG,IAAEA,GAAG,CAACC,OAAO,CAACC,KAAK,CAAC,EAAE,EAAE,CAAChC,MAAM,EAAE8B,GAAG,CAACG,GAAG,CAAC,CAAC,CAAC;IAC5D,CAAC,CAAC;;EAGN;EACA,IAAIlC,GAAG,CAACmC,OAAO,EAAE;IACblD,MAAM,CAACC,MAAM,CAACe,MAAM,EAAED,GAAG,CAACmC,OAAO,CAAC;;EAGtC;EACA,IAAInC,GAAG,CAACoC,QAAQ,EAAE;IACdpC,GAAG,CAACoC,QAAQ,CAACnC,MAAM,CAAC;;EAGxB,OAAOvC,eAAe,CAACuC,MAAM,CAAC;AAClC;AACA,SAASnC,KAAKA,CAACe,IAAU,EAAEoB,MAAuB;EAC9C,MAAMC,IAAI,GAAGvC,UAAU,CAACkB,IAAI,CAACsB,SAAS,CAAC;EACvCD,IAAI,CAACmC,WAAW,GAAG,IAAI;EACvB,MAAMC,SAAS,GAAG1E,YAAY,CAACiB,IAAI,CAACsB,SAAS,CAAC;EAC9C,IAAImC,SAAS,EAAE;IACX,IAAI,CAACA,SAAS,CAACD,WAAW,EAAE;MACxB,MAAM,2DAA2D,GAAGnC,IAAI,CAACqC,MAAM;;IAEnF,IAAID,SAAS,CAACE,kBAAkB,KAAK,IAAI,EAAE;MACvC,MAAM,uBAAuB;;;EAGrC,MAAMC,SAAS,GAAG1C,cAAc,CAAClB,IAAI,EAAEoB,MAAM,EAAEqC,SAAS,KAAK,IAAI,GAAGI,SAAS,GAAGJ,SAAS,CAACE,kBAAkB,CAAC;EAC7GC,SAAS,CAACE,gBAAgB,GAAG9D,IAAI;EACjCqB,IAAI,CAACsC,kBAAkB,GAAGC,SAAS;EAClC5D,IAAY,CAAC+D,SAAS,GAAGH,SAAS;AACvC;AACA,SAASI,UAAUA,CAACC,EAAgD,EAAE9C,GAAwB,EAAEgB,GAA2B;EACvH,IAAI,OAAOhB,GAAG,KAAK,UAAU,EAAE;IAC3B,OAAOrB,mBAAmB,CAACoE,wBAAwB,CAAC,UAAUlE,IAAU;MACpE,OAAOiE,EAAE,CAACjE,IAAI,EAAE,EAAE,CAAC;IACvB,CAAC,CAAC,CAACmB,GAAG,EAAEgB,GAAG,CAAC;;EAEhB,OAAOrC,mBAAmB,CAACoE,wBAAwB,CAAC,UAAUlE,IAAU;IACpE,OAAOiE,EAAE,CAACjE,IAAI,EAAEmB,GAAG,CAAC;EACxB,CAAC,CAAC;AACN;AACA,OAAM,SAAUgD,aAAaA,CAAChD,GAAwB,EAAEgB,GAA2B;EAC/E,OAAO6B,UAAU,CAAC,UAAUhE,IAAU,EAAEoB,MAAuB;IAC3DnC,KAAK,CAACe,IAAI,EAAEoB,MAAM,CAAC;IACnB,OAAOpB,IAAI;EACf,CAAC,EAAEmB,GAAG,EAAEgB,GAAG,CAAC;AAChB;AAEA,OAAO,MAAMiC,SAAS,GAAGD,aAAa;AAEtC,OAAM,SAAUE,QAAQA,CAAiBrE,IAAO;EAC5C,MAAMqB,IAAI,GAAGvC,UAAU,CAACkB,IAAI,CAACsB,SAAS,CAAC;EACvC,IAAI,CAACD,IAAI,CAACmC,WAAW,EAAE;IACnB,MAAM,aAAa;;EAEvB,MAAMc,MAAM,GAAGjD,IAAI,CAACsC,kBAAkB;EACtC,IAAI,CAACW,MAAM,EAAE;IACT,MAAM,aAAa;;EAEvB,OAAOA,MAAM;AACjB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}